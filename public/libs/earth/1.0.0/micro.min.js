window.µ=function(){"use strict";var t=2*Math.PI,e=36e-6,n=u()?"/data/earth-topo-mobile.json?v2":"/data/earth-topo.json?v2";function r(t){return!!t}function o(t){return null!=t}function i(t,e){return o(t)?t:e}function a(t,e){var n=t.toString(),r=Math.max(e-n.length,0);return new Array(r+1).join("0")+n}function u(){return/android|blackberry|iemobile|ipad|iphone|ipod|opera mini|webos/i.test(navigator.userAgent)}function c(t,e,n){if(!e)return t.substr(0,4)+n+t.substr(4,2)+n+t.substr(6,2);var r=t.substr(0,10).split(e);return[r[0],r[1],r[2]].join(n)}function s(t,e){var n=t[0],r=t[1],o=t[2],i=e[0]-n,a=e[1]-r,u=e[2]-o;return function(t,e){return[Math.floor(n+t*i),Math.floor(r+t*a),Math.floor(o+t*u),e]}}function l(e,n){var r=e*t*5/6;r*=.75;var o=Math.sin(r),i=Math.cos(r);return[Math.floor(255*Math.max(0,-i)),Math.floor(255*Math.max(o,0)),Math.floor(255*Math.max(i,0,-o)),n]}var d=.45,f=s(l(1,0),[255,255,255]);function h(t,e){return e.conversion(t).toFixed(e.precision)}function g(t,e,r){var u,c={},s=/^(current|(\d{4})\/(\d{1,2})\/(\d{1,2})\/(\d{3,4})Z)\/(\w+)\/(\w+)\/(\w+)([\/].+)?/.exec(t);if(s){var l="current"===s[1]?"current":s[2]+"/"+a(s[3],2)+"/"+a(s[4],2),d=o(s[5])?a(s[5],4):"";c={date:l,hour:d,param:s[6],surface:s[7],level:s[8],projection:"orthographic",orientation:"",topology:n,overlayType:"default",showGridPoints:!1},i(s[9],"").split("/").forEach((function(t){(u=/^(\w+)(=([\d\-.,]*))?$/.exec(t))?e.has(u[1])&&(c.projection=u[1],c.orientation=i(u[3],"")):(u=/^overlay=(\w+)$/.exec(t))?(r.has(u[1])||"default"===u[1])&&(c.overlayType=u[1]):(u=/^grid=(\w+)$/.exec(t))&&"on"===u[1]&&(c.showGridPoints=!0)}))}return c}var v=Backbone.Model.extend({id:0,_ignoreNextHashChangeEvent:!1,_projectionNames:null,_overlayTypes:null,toHash:function(){var t=this.attributes,e="current"===t.date?"current":t.date+"/"+t.hour+"Z",n=[t.projection,t.orientation].filter(r).join("="),i=o(t.overlayType)&&"default"!==t.overlayType?"overlay="+t.overlayType:"",a=t.showGridPoints?"grid=on":"";return[e,t.param,t.surface,t.level,i,n,a].filter(r).join("/")},sync:function(t,e,n){switch(t){case"read":if("hashchange"===n.trigger&&e._ignoreNextHashChangeEvent)return void(e._ignoreNextHashChangeEvent=!1);e.set(g(window.location.hash.substr(1)||"current/wind/surface/level/orthographic",e._projectionNames,e._overlayTypes));break;case"update":e._ignoreNextHashChangeEvent=!0,window.location.hash=e.toHash()}}});return{isTruthy:r,isValue:o,coalesce:i,floorMod:function(t,e){var n=t-e*Math.floor(t/e);return n===e?0:n},distance:function(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)},clamp:function(t,e,n){return Math.max(e,Math.min(t,n))},proportion:function(t,e,n){return(µ.clamp(t,e,n)-e)/(n-e)},spread:function(t,e,n){return t*(n-e)+e},zeroPad:a,capitalize:function(t){return 0===t.length?t:t.charAt(0).toUpperCase()+t.substr(1)},isFF:function(){return/firefox/i.test(navigator.userAgent)},isMobile:u,isEmbeddedInIFrame:function(){return window!=window.top},toUTCISO:function(t){return t.getUTCFullYear()+"-"+a(t.getUTCMonth()+1,2)+"-"+a(t.getUTCDate(),2)+" "+a(t.getUTCHours(),2)+":00"},toLocalISO:function(t){return t.getFullYear()+"-"+a(t.getMonth()+1,2)+"-"+a(t.getDate(),2)+" "+a(t.getHours(),2)+":00"},ymdRedelimit:c,dateToUTCymd:function(t,e){return c(t.toISOString(),"-",e||"")},dateToConfig:function(t){return{date:µ.dateToUTCymd(t,"/"),hour:µ.zeroPad(t.getUTCHours(),2)+"00"}},log:function(){function t(t){return t&&t.stack?t+"\n"+t.stack:t}return{debug:function(e){console&&console.log&&console.log(t(e))},info:function(e){console&&console.info&&console.info(t(e))},error:function(e){console&&console.error&&console.error(t(e))},time:function(e){console&&console.time&&console.time(t(e))},timeEnd:function(e){console&&console.timeEnd&&console.timeEnd(t(e))}}},view:function(){var t=window,e=document&&document.documentElement,n=document&&document.getElementsByTagName("body")[0];return{width:t.innerWidth||e.clientWidth||n.clientWidth,height:t.innerHeight||e.clientHeight||n.clientHeight}},removeChildren:function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},clearCanvas:function(t){return t.getContext("2d").clearRect(0,0,t.width,t.height),t},sinebowColor:l,extendedSinebowColor:function(t,e){return t<=d?l(t/d,e):f((t-d)/.55,e)},windIntensityColorScale:function(t,e){for(var n=[],r=85;r<=255;r+=t)n.push("rgba("+r+", "+r+", "+r+", 1)");return n.indexFor=function(t){return Math.floor(Math.min(t,e)/e*(n.length-1))},n},segmentedColorScale:function(t){for(var e=[],n=[],r=[],o=0;o<t.length-1;o++)e.push(t[o+1][0]),n.push(s(t[o][1],t[o+1][1])),r.push([t[o][0],t[o+1][0]]);return function(t,o){var i;for(i=0;i<e.length-1&&!(t<=e[i]);i++);var a=r[i];return n[i](µ.proportion(t,a[0],a[1]),o)}},formatCoordinates:function(t,e){return Math.abs(e).toFixed(2)+"° "+(e>=0?"N":"S")+", "+Math.abs(t).toFixed(2)+"° "+(t>=0?"E":"W")},formatScalar:h,formatVector:function(e,n){var r=Math.atan2(-e[0],-e[1])/t*360;return(5*Math.round((r+360)%360/5)).toFixed(0)+"° @ "+h(e[2],n)},loadJson:function(t){var e=when.defer();return d3.json(t,(function(n,r){return n?n.status?e.reject({status:n.status,message:n.statusText,resource:t}):e.reject({status:-1,message:"Cannot load resource: "+t,resource:t}):e.resolve(r)})),e.promise},distortion:function(n,r,o,i,a){var u=r<0?e:-e,c=o<0?e:-e,s=n([r+u,o]),l=n([r,o+c]),d=Math.cos(o/360*t);return[(s[0]-i)/u/d,(s[1]-a)/u/d,(l[0]-i)/c,(l[1]-a)/c]},newAgent:function(t){function e(){return function t(){return t.requested=!0,o}}var n=t,r=_.debounce((function(t,e){function r(t){o.trigger("fail",t,o)}try{var i=e[0];when.all(_.rest(e)).then((function(e){return t.requested?null:_.isFunction(i)?i.apply(o,e):i})).then((function(e){t.requested||(n=e,o.trigger("update",e,o))}),(function(e){t.requested||o.trigger("reject",e,o)})).done(void 0,r),o.trigger("submit",o)}catch(t){r(t)}}),0),o={value:function(){return n},cancel:e(),submit:function(t,n,o,i){return this.cancel(),r(this.cancel=e(),arguments),this}};return _.extend(o,Backbone.Events)},parse:g,buildConfiguration:function(t,e){var n=new v;return n._projectionNames=t,n._overlayTypes=e,n}}}();